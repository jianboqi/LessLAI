# LessLAI  
**Fast GPU/CPU LUT-based forest Leaf Area Index (LAI) retrieval for Landsat 8/9**

## 1. What's LessLAI?
`LessLAI` (LESS-derived Landsat LAI retrieval using LiDAR-informed 3D LUTs) is an open-source tool that retrieves **Leaf Area Index (LAI)** of **Forest** from **Landsat 8/9** imagery using **Look-Up Table (LUT)** matching. The LUT is generated by LESS RT model ([www.lessrt.org](https://lessrt.org/)) combined with PATH RT model and LiDAR data. 
- **Inputs**: **Solar zenith angle (SZA)** and **an image with 3 bands**, including Red, NIR, Land-use (GCL_FCS30D) 
- **Output**: LAI map (GeoTIFF, single band, `-9999` nodata)  
- **Backend**: GPU first, CPU fallback (via [Taichi](https://taichi-lang.org/)) 

## 2. Features
- üöÄ **GPU acceleration** (Taichi) with **CPU fallback**  
- üõ∞Ô∏è **Landsat 8 & 9 ready** ‚Äì one switch (`--sensor L8/L9`)  
- üì¶ **Pure Python** ‚Äì no compiled binaries, cross-platform  
- ‚ö° **Single command** ‚Äì zero configuration for quick tests

## 3. Installation
You can directly download the code and auxiliary data, since there is only one code file: `less_lai.py` or: 
```bash
git clone https://github.com/YOUR_NAME/LessLAI.git
cd LessLAI

# 1. Create env (optional)
conda create -n lesslai python=3.9
conda activate lesslai

# 2. Install dependencies
pip install -r requirements.txt   # taichi numpy gdal
```

## 4. File Hierarchy
```
LessLAI/
‚îú‚îÄ‚îÄ less_lai.py                 # main script
‚îú‚îÄ‚îÄ luts/                       # angle-aware LUTs
‚îÇ   ‚îú‚îÄ‚îÄ EBF_lut_L8.npy
‚îÇ   ‚îú‚îÄ‚îÄ DBF_lut_L8.npy
‚îÇ   ‚îú‚îÄ‚îÄ ENF_lut_L8.npy
‚îÇ   ‚îú‚îÄ‚îÄ DNF_lut_L8.npy
‚îÇ   ‚îú‚îÄ‚îÄ backup.npy
‚îÇ   ‚îî‚îÄ‚îÄ *L9*.npy  (same names for L9)
‚îú‚îÄ‚îÄ examples/
‚îÇ   ‚îî‚îÄ‚îÄ Landsat8_3bands.tif
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ requirements.txt
```

## 5. Quick Start ‚Äì Landsat-8 Example
Data: examples/Landsat8_3bands.tif (Red, NIR, Land-use), SZA: 25¬∞
```bash
python less_lai.py \
  -i examples/Landsat8_3bands.tif \
  -o examples/LAI.tif \
  -sza 25
```

Possible console output:
```‚Üí Using GPU backend
LUT filtered by SZA = 25.0¬∞
Processing complete -> examples/LAI.tif  (SZA=25.0¬∞)
Elapsed time: ** s
```

## 6. Parameters reference
| Short | Long         | Required | Default | Description                                               |
|-------|--------------|----------|---------|-----------------------------------------------------------|
| `-i`  | `--input`    | ‚úÖ       | ‚Äî       | Input 3-band GeoTIFF (Red, NIR, Landuse)                  |
| `-o`  | `--output`   | ‚úÖ       | ‚Äî       | Output LAI GeoTIFF                                        |
| `-sza`| ‚Äî            | ‚úÖ       | ‚Äî       | Solar zenith angle (degrees) to match in LUT              |
| `--sensor`  | ‚Äî | ‚ùå       | `L8`    | Landsat mission: `L8` or `L9`                             |
| `--cpu`| ‚Äî           | ‚ùå       | GPU     | Force CPU backend (fallback if GPU not available)         |

## 7. Landsat 9 Example
```
python less_lai.py -i L09_3bands.tif -o LC09_LAI.tif -sza 32.4 --sensor L9
```

## 8. Others
less_lai_naive.py is only used for debug